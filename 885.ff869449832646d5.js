"use strict";(self.webpackChunkrecuento_inventory=self.webpackChunkrecuento_inventory||[]).push([[885],{4406:(P,_,c)=>{c.r(_),c.d(_,{OrderRequestFormComponent:()=>N});var F=c(177),v=c(8094),u=c(4341),e=c(4438),b=c(8415);function k(d,m){1&d&&(e.j41(0,"div",47),e.EFF(1," La fecha es requerida "),e.k0s())}function f(d,m){1&d&&(e.j41(0,"div",47),e.EFF(1," El n\xfamero de pedido es requerido "),e.k0s())}function j(d,m){1&d&&(e.j41(0,"div",47),e.EFF(1," La dependencia es requerida "),e.k0s())}function E(d,m){1&d&&(e.j41(0,"div",48),e.qSk(),e.j41(1,"svg",49),e.nrm(2,"path",50)(3,"path",51),e.k0s(),e.joV(),e.j41(4,"p",52),e.EFF(5,"No hay productos agregados"),e.k0s(),e.j41(6,"p",53),e.EFF(7,' Haz clic en "Agregar Producto" para comenzar '),e.k0s()())}function y(d,m){1&d&&(e.j41(0,"div",69),e.EFF(1," Requerido "),e.k0s())}function q(d,m){1&d&&(e.j41(0,"div",69),e.EFF(1," Requerido "),e.k0s())}function R(d,m){1&d&&(e.j41(0,"span"),e.EFF(1,"Requerido"),e.k0s())}function x(d,m){1&d&&(e.j41(0,"span"),e.EFF(1,"M\xednimo 1"),e.k0s())}function O(d,m){if(1&d&&(e.j41(0,"div",69),e.DNE(1,R,2,0,"span",70)(2,x,2,0,"span",70),e.k0s()),2&d){let n,s;const o=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf",null==(n=o.get("cantidadSolicitada"))||null==n.errors?null:n.errors.required),e.R7$(),e.Y8G("ngIf",null==(s=o.get("cantidadSolicitada"))||null==s.errors?null:s.errors.min)}}function A(d,m){if(1&d){const n=e.RV6();e.j41(0,"tr",61)(1,"td"),e.nrm(2,"input",62),e.DNE(3,y,2,0,"div",63),e.k0s(),e.j41(4,"td"),e.nrm(5,"textarea",64),e.DNE(6,q,2,0,"div",63),e.k0s(),e.j41(7,"td"),e.nrm(8,"input",65),e.DNE(9,O,3,2,"div",63),e.k0s(),e.j41(10,"td"),e.nrm(11,"textarea",66),e.k0s(),e.j41(12,"td")(13,"button",67),e.bIt("click",function(){const o=e.eBV(n).index,a=e.XpG(2);return e.Njj(a.removeProduct(o))}),e.qSk(),e.j41(14,"svg",5),e.nrm(15,"path",68),e.k0s()()()()}if(2&d){let n,s,o,a,l,r;const t=m.$implicit;e.Y8G("formGroupName",m.index),e.R7$(2),e.AVh("border-red-500",(null==(n=t.get("numeroOrden"))?null:n.invalid)&&(null==(n=t.get("numeroOrden"))?null:n.touched)),e.R7$(),e.Y8G("ngIf",(null==(s=t.get("numeroOrden"))?null:s.invalid)&&(null==(s=t.get("numeroOrden"))?null:s.touched)),e.R7$(2),e.AVh("border-red-500",(null==(o=t.get("descripcion"))?null:o.invalid)&&(null==(o=t.get("descripcion"))?null:o.touched)),e.R7$(),e.Y8G("ngIf",(null==(a=t.get("descripcion"))?null:a.invalid)&&(null==(a=t.get("descripcion"))?null:a.touched)),e.R7$(2),e.AVh("border-red-500",(null==(l=t.get("cantidadSolicitada"))?null:l.invalid)&&(null==(l=t.get("cantidadSolicitada"))?null:l.touched)),e.R7$(),e.Y8G("ngIf",(null==(r=t.get("cantidadSolicitada"))?null:r.invalid)&&(null==(r=t.get("cantidadSolicitada"))?null:r.touched))}}function I(d,m){if(1&d&&(e.j41(0,"div",54)(1,"table",55)(2,"thead",56)(3,"tr")(4,"th",57),e.EFF(5,"N\xb0 Orden"),e.k0s(),e.j41(6,"th"),e.EFF(7,"Descripci\xf3n"),e.k0s(),e.j41(8,"th",58),e.EFF(9,"Cantidad"),e.k0s(),e.j41(10,"th"),e.EFF(11,"Observaciones"),e.k0s(),e.j41(12,"th",59),e.EFF(13,"Acciones"),e.k0s()()(),e.j41(14,"tbody"),e.DNE(15,A,16,10,"tr",60),e.k0s()()()),2&d){const n=e.XpG();e.R7$(15),e.Y8G("ngForOf",n.productos.controls)}}function S(d,m){1&d&&(e.j41(0,"div",47),e.EFF(1," El nombre del funcionario autorizado es requerido "),e.k0s())}function C(d,m){1&d&&(e.qSk(),e.j41(0,"svg",71),e.nrm(1,"circle",72)(2,"path",73),e.k0s())}let N=(()=>{class d{constructor(n,s,o,a){this.formBuilder=n,this.orderRequestService=s,this.route=o,this.router=a,this.isEditing=!1,this.orderRequestId=null,this.isSubmitting=!1,this.orderRequestForm=this.createForm()}ngOnInit(){if(this.orderRequestId=this.route.snapshot.paramMap.get("id"),this.isEditing=!!this.orderRequestId,!this.isEditing){const n=(new Date).toISOString().split("T")[0];this.orderRequestForm.patchValue({fecha:n}),this.generateOrderNumber()}this.isEditing&&this.orderRequestId&&this.loadOrderRequest(this.orderRequestId)}createForm(){return this.formBuilder.group({fecha:["",[u.k0.required]],numeroPedido:["",[u.k0.required]],dependencia:["",[u.k0.required]],productos:this.formBuilder.array([]),funcionarioAutorizado:["",[u.k0.required]]})}get productos(){return this.orderRequestForm.get("productos")}createProductForm(n={}){return this.formBuilder.group({numeroOrden:[n.numeroOrden||"",[u.k0.required]],descripcion:[n.descripcion||"",[u.k0.required]],cantidadSolicitada:[n.cantidadSolicitada||1,[u.k0.required,u.k0.min(1)]],observaciones:[n.observaciones||""]})}addProduct(){const n=String(this.productos.length+1).padStart(3,"0"),s=this.createProductForm({numeroOrden:n});this.productos.push(s)}removeProduct(n){confirm("\xbfEst\xe1s seguro de que deseas eliminar este producto?")&&(this.productos.removeAt(n),this.renumberProducts())}renumberProducts(){this.productos.controls.forEach((n,s)=>{const o=String(s+1).padStart(3,"0");n.get("numeroOrden")?.setValue(o)})}generateOrderNumber(){const n=this.orderRequestService.generateOrderNumber();this.orderRequestForm.patchValue({numeroPedido:n})}loadOrderRequest(n){this.orderRequestService.getOrderRequest(n).subscribe({next:s=>{if(s){for(this.orderRequestForm.patchValue({fecha:s.fecha.toISOString().split("T")[0],numeroPedido:s.numeroPedido,dependencia:s.dependencia,funcionarioAutorizado:s.funcionarioAutorizado});0!==this.productos.length;)this.productos.removeAt(0);s.productos.forEach(o=>{const a=this.createProductForm(o);this.productos.push(a)})}},error:s=>{console.error("Error al cargar solicitud:",s),alert("Error al cargar la solicitud. Regresando a la lista."),this.router.navigate(["/solicitudes"])}})}onSubmit(){if(this.orderRequestForm.valid){if(0===this.productos.length)return void alert("Debe agregar al menos un producto a la solicitud.");this.isSubmitting=!0;const n=this.orderRequestForm.value;(this.isEditing?this.orderRequestService.updateOrderRequest(this.orderRequestId,n):this.orderRequestService.createOrderRequest(n)).subscribe({next:()=>{alert(this.isEditing?"Solicitud actualizada exitosamente":"Solicitud creada exitosamente"),this.router.navigate(["/solicitudes"])},error:o=>{console.error("Error al guardar solicitud:",o),alert("Error al guardar la solicitud. Intenta de nuevo."),this.isSubmitting=!1}})}else Object.keys(this.orderRequestForm.controls).forEach(n=>{const s=this.orderRequestForm.get(n);s?.invalid&&s.markAsTouched()}),this.productos.controls.forEach(n=>{const s=n;Object.keys(s.controls).forEach(o=>{const a=s.get(o);a?.invalid&&a.markAsTouched()})})}static{this.\u0275fac=function(s){return new(s||d)(e.rXU(u.ok),e.rXU(b.z),e.rXU(v.nX),e.rXU(v.Ix))}}static{this.\u0275cmp=e.VBU({type:d,selectors:[["app-order-request-form"]],standalone:!0,features:[e.aNF],decls:86,vars:20,consts:[[1,"space-y-8"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],["routerLink","/solicitudes",1,"btn","btn-secondary","flex","items-center","space-x-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"space-y-8",3,"ngSubmit","formGroup"],[1,"card","p-6"],[1,"text-lg","font-medium","text-gray-900","mb-6"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["for","fecha",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","fecha","type","date","formControlName","fecha",1,"input"],["class","mt-1 text-sm text-red-600",4,"ngIf"],["for","numeroPedido",1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"flex","space-x-2"],["id","numeroPedido","type","text","formControlName","numeroPedido","placeholder","PED-2024-001",1,"input","flex-1"],["type","button","title","Generar n\xfamero autom\xe1tico",1,"btn","btn-secondary","px-3",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],["for","dependencia",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","dependencia","formControlName","dependencia",1,"input"],["value",""],["value","Almac\xe9n Central"],["value","Oficina Administrativa"],["value","Departamento de Sistemas"],["value","Recursos Humanos"],["value","Contabilidad"],["value","Gerencia General"],["value","Ventas"],["value","Marketing"],["value","Producci\xf3n"],[1,"card"],[1,"p-6","border-b","border-gray-200"],[1,"text-lg","font-medium","text-gray-900"],["type","button",1,"btn","btn-primary","flex","items-center","space-x-2",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 6v6m0 0v6m0-6h6m-6 0H6"],[1,"p-6"],["class","text-center py-12 text-gray-500",4,"ngIf"],["class","overflow-x-auto",4,"ngIf"],[1,"max-w-md"],["for","funcionarioAutorizado",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","funcionarioAutorizado","type","text","formControlName","funcionarioAutorizado","placeholder","Nombre completo del funcionario",1,"input"],[1,"mt-2","text-sm","text-gray-500"],[1,"flex","justify-end","space-x-4","pt-6","border-t","border-gray-200"],["routerLink","/solicitudes",1,"btn","btn-secondary"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","animate-spin -ml-1 mr-2 h-4 w-4","fill","none","viewBox","0 0 24 24",4,"ngIf"],[1,"mt-1","text-sm","text-red-600"],[1,"text-center","py-12","text-gray-500"],["fill","currentColor","viewBox","0 0 20 20",1,"w-16","h-16","mx-auto","mb-4","text-gray-300"],["fill-rule","evenodd","d","M4 3a2 2 0 100 4h12a2 2 0 100-4H4z"],["fill-rule","evenodd","d","M3 8h14v7a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z","clip-rule","evenodd"],[1,"text-lg","font-medium"],[1,"text-sm"],[1,"overflow-x-auto"],[1,"table"],[1,"bg-gray-50"],[1,"w-24"],[1,"w-32"],[1,"w-20"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],["type","text","formControlName","numeroOrden","placeholder","001",1,"input","text-center"],["class","mt-1 text-xs text-red-600",4,"ngIf"],["formControlName","descripcion","rows","2","placeholder","Descripci\xf3n del producto",1,"input"],["type","number","min","1","formControlName","cantidadSolicitada","placeholder","1",1,"input","text-center"],["formControlName","observaciones","rows","2","placeholder","Observaciones adicionales",1,"input"],["type","button","title","Eliminar producto",1,"text-red-600","hover:text-red-800","p-1",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1-1H8a1 1 0 00-1 1v3M4 7h16"],[1,"mt-1","text-xs","text-red-600"],[4,"ngIf"],["fill","none","viewBox","0 0 24 24",1,"animate-spin","-ml-1","mr-2","h-4","w-4"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"]],template:function(s,o){if(1&s&&(e.j41(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),e.EFF(4),e.k0s(),e.j41(5,"p",3),e.EFF(6),e.k0s()(),e.j41(7,"a",4),e.qSk(),e.j41(8,"svg",5),e.nrm(9,"path",6),e.k0s(),e.joV(),e.j41(10,"span"),e.EFF(11,"Volver"),e.k0s()()(),e.j41(12,"form",7),e.bIt("ngSubmit",function(){return o.onSubmit()}),e.j41(13,"div",8)(14,"h2",9),e.EFF(15," Informaci\xf3n General "),e.k0s(),e.j41(16,"div",10)(17,"div")(18,"label",11),e.EFF(19," Fecha * "),e.k0s(),e.nrm(20,"input",12),e.DNE(21,k,2,0,"div",13),e.k0s(),e.j41(22,"div")(23,"label",14),e.EFF(24," N\xfamero de Pedido * "),e.k0s(),e.j41(25,"div",15),e.nrm(26,"input",16),e.j41(27,"button",17),e.bIt("click",function(){return o.generateOrderNumber()}),e.qSk(),e.j41(28,"svg",5),e.nrm(29,"path",18),e.k0s()()(),e.DNE(30,f,2,0,"div",13),e.k0s(),e.joV(),e.j41(31,"div")(32,"label",19),e.EFF(33," Dependencia * "),e.k0s(),e.j41(34,"select",20)(35,"option",21),e.EFF(36,"Seleccione una dependencia"),e.k0s(),e.j41(37,"option",22),e.EFF(38,"Almac\xe9n Central"),e.k0s(),e.j41(39,"option",23),e.EFF(40," Oficina Administrativa "),e.k0s(),e.j41(41,"option",24),e.EFF(42," Departamento de Sistemas "),e.k0s(),e.j41(43,"option",25),e.EFF(44,"Recursos Humanos"),e.k0s(),e.j41(45,"option",26),e.EFF(46,"Contabilidad"),e.k0s(),e.j41(47,"option",27),e.EFF(48,"Gerencia General"),e.k0s(),e.j41(49,"option",28),e.EFF(50,"Ventas"),e.k0s(),e.j41(51,"option",29),e.EFF(52,"Marketing"),e.k0s(),e.j41(53,"option",30),e.EFF(54,"Producci\xf3n"),e.k0s()(),e.DNE(55,j,2,0,"div",13),e.k0s()()(),e.j41(56,"div",31)(57,"div",32)(58,"div",1)(59,"h2",33),e.EFF(60," Productos Solicitados "),e.k0s(),e.j41(61,"button",34),e.bIt("click",function(){return o.addProduct()}),e.qSk(),e.j41(62,"svg",5),e.nrm(63,"path",35),e.k0s(),e.joV(),e.j41(64,"span"),e.EFF(65,"Agregar Producto"),e.k0s()()()(),e.j41(66,"div",36),e.DNE(67,E,8,0,"div",37)(68,I,16,1,"div",38),e.k0s()(),e.j41(69,"div",8)(70,"h2",9),e.EFF(71," Funcionario Autorizado "),e.k0s(),e.j41(72,"div",39)(73,"label",40),e.EFF(74," Nombre y Apellido del Funcionario Autorizado a Retirar * "),e.k0s(),e.nrm(75,"input",41),e.DNE(76,S,2,0,"div",13),e.j41(77,"p",42),e.EFF(78," Esta persona ser\xe1 la \xfanica autorizada para retirar los productos solicitados "),e.k0s()()(),e.j41(79,"div",43)(80,"a",44),e.EFF(81," Cancelar "),e.k0s(),e.j41(82,"button",45),e.DNE(83,C,3,0,"svg",46),e.j41(84,"span"),e.EFF(85),e.k0s()()()()()),2&s){let a,l,r,t,i,p,h,g;e.R7$(4),e.SpI(" ",o.isEditing?"Editar Solicitud":"Nueva Solicitud de Pedido"," "),e.R7$(2),e.SpI(" ",o.isEditing?"Modifica los datos de la solicitud":"Completa el formulario para crear una nueva solicitud de pedido"," "),e.R7$(6),e.Y8G("formGroup",o.orderRequestForm),e.R7$(8),e.AVh("border-red-500",(null==(a=o.orderRequestForm.get("fecha"))?null:a.invalid)&&(null==(a=o.orderRequestForm.get("fecha"))?null:a.touched)),e.R7$(),e.Y8G("ngIf",(null==(l=o.orderRequestForm.get("fecha"))?null:l.invalid)&&(null==(l=o.orderRequestForm.get("fecha"))?null:l.touched)),e.R7$(5),e.AVh("border-red-500",(null==(r=o.orderRequestForm.get("numeroPedido"))?null:r.invalid)&&(null==(r=o.orderRequestForm.get("numeroPedido"))?null:r.touched)),e.R7$(4),e.Y8G("ngIf",(null==(t=o.orderRequestForm.get("numeroPedido"))?null:t.invalid)&&(null==(t=o.orderRequestForm.get("numeroPedido"))?null:t.touched)),e.R7$(4),e.AVh("border-red-500",(null==(i=o.orderRequestForm.get("dependencia"))?null:i.invalid)&&(null==(i=o.orderRequestForm.get("dependencia"))?null:i.touched)),e.R7$(21),e.Y8G("ngIf",(null==(p=o.orderRequestForm.get("dependencia"))?null:p.invalid)&&(null==(p=o.orderRequestForm.get("dependencia"))?null:p.touched)),e.R7$(12),e.Y8G("ngIf",0===o.productos.length),e.R7$(),e.Y8G("ngIf",o.productos.length>0),e.R7$(7),e.AVh("border-red-500",(null==(h=o.orderRequestForm.get("funcionarioAutorizado"))?null:h.invalid)&&(null==(h=o.orderRequestForm.get("funcionarioAutorizado"))?null:h.touched)),e.R7$(),e.Y8G("ngIf",(null==(g=o.orderRequestForm.get("funcionarioAutorizado"))?null:g.invalid)&&(null==(g=o.orderRequestForm.get("funcionarioAutorizado"))?null:g.touched)),e.R7$(6),e.Y8G("disabled",o.orderRequestForm.invalid||o.isSubmitting),e.R7$(),e.Y8G("ngIf",o.isSubmitting),e.R7$(2),e.JRh(o.isSubmitting?o.isEditing?"Actualizando...":"Guardando...":o.isEditing?"Actualizar Solicitud":"Crear Solicitud")}},dependencies:[F.MD,F.Sq,F.bT,v.iI,v.Wk,u.X1,u.qT,u.xH,u.y7,u.me,u.Q0,u.wz,u.BC,u.cb,u.VZ,u.j4,u.JD,u.$R],encapsulation:2})}}return d})()},8384:(P,_,c)=>{c.d(_,{c:()=>a});var F=c(8359);class v extends F.yU{constructor(r,t){super()}schedule(r,t=0){return this}}const u={setInterval(l,r,...t){const{delegate:i}=u;return i?.setInterval?i.setInterval(l,r,...t):setInterval(l,r,...t)},clearInterval(l){const{delegate:r}=u;return(r?.clearInterval||clearInterval)(l)},delegate:void 0};var e=c(7908);const k={now:()=>(k.delegate||Date).now(),delegate:void 0};class f{constructor(r,t=f.now){this.schedulerActionCtor=r,this.now=t}schedule(r,t=0,i){return new this.schedulerActionCtor(this,r).schedule(i,t)}}f.now=k.now;const E=new class j extends f{constructor(r,t=f.now){super(r,t),this.actions=[],this._active=!1}flush(r){const{actions:t}=this;if(this._active)return void t.push(r);let i;this._active=!0;do{if(i=r.execute(r.state,r.delay))break}while(r=t.shift());if(this._active=!1,i){for(;r=t.shift();)r.unsubscribe();throw i}}}(class b extends v{constructor(r,t){super(r,t),this.scheduler=r,this.work=t,this.pending=!1}schedule(r,t=0){var i;if(this.closed)return this;this.state=r;const p=this.id,h=this.scheduler;return null!=p&&(this.id=this.recycleAsyncId(h,p,t)),this.pending=!0,this.delay=t,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(h,this.id,t),this}requestAsyncId(r,t,i=0){return u.setInterval(r.flush.bind(r,this),i)}recycleAsyncId(r,t,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return t;null!=t&&u.clearInterval(t)}execute(r,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(r,t);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(r,t){let p,i=!1;try{this.work(r)}catch(h){i=!0,p=h||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),p}unsubscribe(){if(!this.closed){const{id:r,scheduler:t}=this,{actions:i}=t;this.work=this.state=this.scheduler=null,this.pending=!1,(0,e.o)(i,this),null!=r&&(this.id=this.recycleAsyncId(t,r,null)),this.delay=null,super.unsubscribe()}}}),y=E;var q=c(8793),R=c(6697),x=c(9974),O=c(4360),A=c(5343),S=c(3703),C=c(1397),N=c(8750);function d(l,r){return r?t=>(0,q.x)(r.pipe((0,R.s)(1),function I(){return(0,x.N)((l,r)=>{l.subscribe((0,O._)(r,A.l))})}()),t.pipe(d(l))):(0,C.Z)((t,i)=>(0,N.Tg)(l(t,i)).pipe((0,R.s)(1),(0,S.u)(t)))}var m=c(1985),n=c(9470);function a(l,r=E){const t=function o(l=0,r,t=y){let i=-1;return null!=r&&((0,n.m)(r)?t=r:i=r),new m.c(p=>{let h=function s(l){return l instanceof Date&&!isNaN(l)}(l)?+l-t.now():l;h<0&&(h=0);let g=0;return t.schedule(function(){p.closed||(p.next(g++),0<=i?this.schedule(void 0,i):p.complete())},h)})}(l,r);return d(()=>t)}}}]);