"use strict";(self.webpackChunkrecuento_inventory=self.webpackChunkrecuento_inventory||[]).push([[912],{2912:(k,M,i)=>{i.r(M),i.d(M,{InventoryHistoryComponent:()=>x});var A=i(177),F=i(8094),g=i(4341),l=i(4412),O=i(4572),E=i(9172),j=i(6354),S=i(2181),t=i(4438),T=i(6241);const _=(p,I,e,v,s)=>({"bg-green-100 text-green-800":p,"bg-red-100 text-red-800":I,"bg-blue-100 text-blue-800":e,"bg-purple-100 text-purple-800":v,"bg-yellow-100 text-yellow-800":s}),a=(p,I,e)=>({"text-green-600":p,"text-red-600":I,"text-blue-600":e});function r(p,I){if(1&p&&(t.j41(0,"div",32)(1,"div",33)(2,"div",34)(3,"div")(4,"p",35),t.EFF(5,"Total Entradas"),t.k0s(),t.j41(6,"p",36),t.EFF(7),t.k0s()(),t.j41(8,"div",37),t.qSk(),t.j41(9,"svg",38),t.nrm(10,"path",39),t.k0s()()()(),t.joV(),t.j41(11,"div",33)(12,"div",34)(13,"div")(14,"p",35),t.EFF(15,"Total Salidas"),t.k0s(),t.j41(16,"p",40),t.EFF(17),t.k0s()(),t.j41(18,"div",41),t.qSk(),t.j41(19,"svg",42),t.nrm(20,"path",43),t.k0s()()()(),t.joV(),t.j41(21,"div",33)(22,"div",34)(23,"div")(24,"p",35),t.EFF(25,"Ajustes"),t.k0s(),t.j41(26,"p",44),t.EFF(27),t.k0s()(),t.j41(28,"div",45),t.qSk(),t.j41(29,"svg",46),t.nrm(30,"path",47)(31,"path",48),t.k0s()()()(),t.joV(),t.j41(32,"div",33)(33,"div",34)(34,"div")(35,"p",35),t.EFF(36,"Total Movimientos"),t.k0s(),t.j41(37,"p",2),t.EFF(38),t.k0s()(),t.j41(39,"div",49),t.qSk(),t.j41(40,"svg",50),t.nrm(41,"path",51),t.k0s()()()()()),2&p){const e=I.ngIf;t.R7$(7),t.SpI(" ",e.totalEntradas," "),t.R7$(10),t.SpI(" ",e.totalSalidas," "),t.R7$(10),t.SpI(" ",e.totalAjustes," "),t.R7$(11),t.SpI(" ",e.totalMovimientos," ")}}function u(p,I){1&p&&(t.j41(0,"tr")(1,"td",52)(2,"div",53),t.qSk(),t.j41(3,"svg",54),t.nrm(4,"path",51),t.k0s(),t.joV(),t.j41(5,"p"),t.EFF(6,"No se encontraron movimientos"),t.k0s(),t.j41(7,"p",55),t.EFF(8," Ajusta los filtros para ver m\xe1s resultados "),t.k0s()()()())}function C(p,I){if(1&p&&(t.j41(0,"tr")(1,"td",56),t.EFF(2),t.nI1(3,"date"),t.k0s(),t.j41(4,"td")(5,"div")(6,"p",57),t.EFF(7),t.k0s(),t.j41(8,"p",58),t.EFF(9),t.k0s()()(),t.j41(10,"td")(11,"span",59),t.EFF(12),t.k0s()(),t.j41(13,"td")(14,"span",60),t.EFF(15),t.k0s()(),t.j41(16,"td",56),t.EFF(17),t.k0s(),t.j41(18,"td",57),t.EFF(19),t.k0s(),t.j41(20,"td",61),t.EFF(21),t.k0s(),t.j41(22,"td",62),t.EFF(23),t.k0s(),t.j41(24,"td",62),t.EFF(25),t.k0s()()),2&p){const e=I.$implicit,v=t.XpG();t.R7$(2),t.SpI(" ",t.i5U(3,13,e.fecha,"dd/MM/yyyy HH:mm")," "),t.R7$(5),t.SpI(" ",v.getProductName(e.productId)," "),t.R7$(2),t.SpI(" ID: ",e.productId," "),t.R7$(2),t.Y8G("ngClass",t.s1E(16,_,"ENTRADA"===e.tipo,"SALIDA"===e.tipo,"AJUSTE"===e.tipo,"TRANSFERENCIA"===e.tipo,"DEVOLUCION"===e.tipo)),t.R7$(),t.SpI(" ",e.tipo," "),t.R7$(2),t.Y8G("ngClass",t.sMw(22,a,"ENTRADA"===e.tipo,"SALIDA"===e.tipo,"AJUSTE"===e.tipo)),t.R7$(),t.Lme(" ","ENTRADA"===e.tipo?"+":"SALIDA"===e.tipo?"-":"\xb1","",e.cantidad," "),t.R7$(2),t.SpI(" ",e.cantidadAnterior," "),t.R7$(2),t.SpI(" ",e.cantidadNueva," "),t.R7$(2),t.SpI(" ",e.motivo," "),t.R7$(2),t.JRh(e.usuario),t.R7$(2),t.JRh(e.ubicacion)}}let x=(()=>{class p{constructor(e){this.productService=e,this.dateFromSubject=new l.t(""),this.dateToSubject=new l.t(""),this.movementTypeSubject=new l.t(""),this.dateFrom="",this.dateTo="",this.selectedMovementType="",this.productNames={},this.movements$=this.productService.getInventoryMovements(),this.productService.getProducts().subscribe(v=>{this.productNames=v.reduce((s,h)=>(s[h.id]=h.nombre,s),{})}),this.filteredMovements$=(0,O.z)([this.movements$,this.dateFromSubject.pipe((0,E.Z)("")),this.dateToSubject.pipe((0,E.Z)("")),this.movementTypeSubject.pipe((0,E.Z)(""))]).pipe((0,j.T)(([v,s,h,c])=>v.filter(f=>{let D=!0;if(s){const m=new Date(s);D=D&&f.fecha>=m}if(h){const m=new Date(h);m.setHours(23,59,59,999),D=D&&f.fecha<=m}return c&&(D=D&&f.tipo===c),D}))),this.periodStats$=this.filteredMovements$.pipe((0,j.T)(v=>{const s={totalEntradas:0,totalSalidas:0,totalAjustes:0,totalMovimientos:v.length};return v.forEach(h=>{switch(h.tipo){case S.UB.ENTRADA:s.totalEntradas+=h.cantidad;break;case S.UB.SALIDA:s.totalSalidas+=h.cantidad;break;case S.UB.AJUSTE:s.totalAjustes+=h.cantidad}}),s}))}ngOnInit(){const e=new Date,v=new Date(e.getFullYear(),e.getMonth()-1,1);this.dateTo=e.toISOString().split("T")[0],this.dateFrom=v.toISOString().split("T")[0],this.dateFromSubject.next(this.dateFrom),this.dateToSubject.next(this.dateTo)}onDateFromChange(e){this.dateFromSubject.next(e)}onDateToChange(e){this.dateToSubject.next(e)}onMovementTypeChange(e){this.movementTypeSubject.next(e)}clearFilters(){this.dateFrom="",this.dateTo="",this.selectedMovementType="",this.dateFromSubject.next(""),this.dateToSubject.next(""),this.movementTypeSubject.next("")}getProductName(e){return this.productNames[e]||"Producto no encontrado"}exportHistory(){this.filteredMovements$.subscribe(e=>{const v=e.map(f=>({Fecha:f.fecha.toLocaleString("es-ES"),Producto:this.getProductName(f.productId),"ID Producto":f.productId,Tipo:f.tipo,Cantidad:f.cantidad,"Stock Anterior":f.cantidadAnterior,"Stock Nuevo":f.cantidadNueva,Motivo:f.motivo,Usuario:f.usuario,Ubicaci\u00f3n:f.ubicacion,Lote:f.lote||""})),s=this.convertToCSV(v),h=new Blob([s],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");if(void 0!==c.download){const f=URL.createObjectURL(h);c.setAttribute("href",f),c.setAttribute("download",`historial_inventario_${(new Date).toISOString().split("T")[0]}.csv`),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)}})}convertToCSV(e){return 0===e.length?"":[Object.keys(e[0]).join(","),...e.map(h=>Object.values(h).map(c=>`"${c}"`).join(","))].join("\n")}static{this.\u0275fac=function(v){return new(v||p)(t.rXU(T.b))}}static{this.\u0275cmp=t.VBU({type:p,selectors:[["app-inventory-history"]],standalone:!0,features:[t.aNF],decls:80,vars:12,consts:[[1,"space-y-6"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],[1,"flex","space-x-3"],[1,"btn","btn-secondary","flex","items-center","space-x-2",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],["routerLink","/inventario",1,"btn","btn-primary","flex","items-center","space-x-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"card","p-4"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","date",1,"input",3,"ngModelChange","ngModel"],[1,"input",3,"ngModelChange","ngModel"],["value",""],["value","ENTRADA"],["value","SALIDA"],["value","AJUSTE"],["value","TRANSFERENCIA"],["value","DEVOLUCION"],[1,"flex","items-end"],["type","button",1,"btn","btn-secondary","w-full",3,"click"],["class","grid grid-cols-1 md:grid-cols-4 gap-6",4,"ngIf"],[1,"card","overflow-hidden"],[1,"p-4","border-b","border-gray-200"],[1,"text-lg","font-medium","text-gray-900"],[1,"overflow-x-auto"],[1,"table"],[1,"bg-gray-50"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-6"],[1,"card","p-6"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-2xl","font-bold","text-green-600"],[1,"w-12","h-12","bg-green-100","rounded-lg","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-green-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"text-2xl","font-bold","text-red-600"],[1,"w-12","h-12","bg-red-100","rounded-lg","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-red-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M20 12H4"],[1,"text-2xl","font-bold","text-blue-600"],[1,"w-12","h-12","bg-blue-100","rounded-lg","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],[1,"w-12","h-12","bg-gray-100","rounded-lg","flex","items-center","justify-center"],["fill","currentColor","viewBox","0 0 20 20",1,"w-6","h-6","text-gray-600"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z","clip-rule","evenodd"],["colspan","9",1,"text-center","py-8","text-gray-500"],[1,"flex","flex-col","items-center"],["fill","currentColor","viewBox","0 0 20 20",1,"w-12","h-12","mb-3","text-gray-300"],[1,"text-sm"],[1,"text-sm","text-gray-900"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-xs","text-gray-500"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium",3,"ngClass"],[1,"text-sm","font-medium",3,"ngClass"],[1,"text-sm","text-gray-500","max-w-xs","truncate"],[1,"text-sm","text-gray-500"]],template:function(v,s){if(1&v&&(t.j41(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),t.EFF(4," Historial de Inventario "),t.k0s(),t.j41(5,"p",3),t.EFF(6," Registro completo de movimientos de inventario "),t.k0s()(),t.j41(7,"div",4)(8,"button",5),t.bIt("click",function(){return s.exportHistory()}),t.qSk(),t.j41(9,"svg",6),t.nrm(10,"path",7),t.k0s(),t.joV(),t.j41(11,"span"),t.EFF(12,"Exportar"),t.k0s()(),t.j41(13,"a",8),t.qSk(),t.j41(14,"svg",6),t.nrm(15,"path",9),t.k0s(),t.joV(),t.j41(16,"span"),t.EFF(17,"Volver al Inventario"),t.k0s()()()(),t.j41(18,"div",10)(19,"div",11)(20,"div")(21,"label",12),t.EFF(22," Fecha Desde "),t.k0s(),t.j41(23,"input",13),t.mxI("ngModelChange",function(c){return t.DH7(s.dateFrom,c)||(s.dateFrom=c),c}),t.bIt("ngModelChange",function(c){return s.onDateFromChange(c)}),t.k0s()(),t.j41(24,"div")(25,"label",12),t.EFF(26," Fecha Hasta "),t.k0s(),t.j41(27,"input",13),t.mxI("ngModelChange",function(c){return t.DH7(s.dateTo,c)||(s.dateTo=c),c}),t.bIt("ngModelChange",function(c){return s.onDateToChange(c)}),t.k0s()(),t.j41(28,"div")(29,"label",12),t.EFF(30," Tipo de Movimiento "),t.k0s(),t.j41(31,"select",14),t.mxI("ngModelChange",function(c){return t.DH7(s.selectedMovementType,c)||(s.selectedMovementType=c),c}),t.bIt("ngModelChange",function(c){return s.onMovementTypeChange(c)}),t.j41(32,"option",15),t.EFF(33,"Todos"),t.k0s(),t.j41(34,"option",16),t.EFF(35,"Entrada"),t.k0s(),t.j41(36,"option",17),t.EFF(37,"Salida"),t.k0s(),t.j41(38,"option",18),t.EFF(39,"Ajuste"),t.k0s(),t.j41(40,"option",19),t.EFF(41,"Transferencia"),t.k0s(),t.j41(42,"option",20),t.EFF(43,"Devoluci\xf3n"),t.k0s()()(),t.j41(44,"div",21)(45,"button",22),t.bIt("click",function(){return s.clearFilters()}),t.EFF(46," Limpiar Filtros "),t.k0s()()()(),t.DNE(47,r,42,4,"div",23),t.nI1(48,"async"),t.j41(49,"div",24)(50,"div",25)(51,"h3",26),t.EFF(52," Movimientos de Inventario "),t.k0s()(),t.j41(53,"div",27)(54,"table",28)(55,"thead",29)(56,"tr")(57,"th"),t.EFF(58,"Fecha y Hora"),t.k0s(),t.j41(59,"th"),t.EFF(60,"Producto"),t.k0s(),t.j41(61,"th"),t.EFF(62,"Tipo"),t.k0s(),t.j41(63,"th"),t.EFF(64,"Cantidad"),t.k0s(),t.j41(65,"th"),t.EFF(66,"Stock Anterior"),t.k0s(),t.j41(67,"th"),t.EFF(68,"Stock Nuevo"),t.k0s(),t.j41(69,"th"),t.EFF(70,"Motivo"),t.k0s(),t.j41(71,"th"),t.EFF(72,"Usuario"),t.k0s(),t.j41(73,"th"),t.EFF(74,"Ubicaci\xf3n"),t.k0s()()(),t.j41(75,"tbody"),t.DNE(76,u,9,0,"tr",30),t.nI1(77,"async"),t.DNE(78,C,26,26,"tr",31),t.nI1(79,"async"),t.k0s()()()()()),2&v){let h;t.R7$(23),t.R50("ngModel",s.dateFrom),t.R7$(4),t.R50("ngModel",s.dateTo),t.R7$(4),t.R50("ngModel",s.selectedMovementType),t.R7$(16),t.Y8G("ngIf",t.bMT(48,6,s.periodStats$)),t.R7$(29),t.Y8G("ngIf",0===(null==(h=t.bMT(77,8,s.filteredMovements$))?null:h.length)),t.R7$(2),t.Y8G("ngForOf",t.bMT(79,10,s.filteredMovements$))}},dependencies:[A.MD,A.YU,A.Sq,A.bT,A.Jj,A.vh,F.iI,F.Wk,g.YN,g.xH,g.y7,g.me,g.wz,g.BC,g.vS],encapsulation:2})}}return p})()},2181:(k,M,i)=>{i.d(M,{Sz:()=>A,UB:()=>F,vT:()=>g});var A=function(l){return l.ACTIVO="ACTIVO",l.INACTIVO="INACTIVO",l.AGOTADO="AGOTADO",l.VENCIDO="VENCIDO",l.RESERVADO="RESERVADO",l}(A||{}),F=function(l){return l.ENTRADA="ENTRADA",l.SALIDA="SALIDA",l.AJUSTE="AJUSTE",l.TRANSFERENCIA="TRANSFERENCIA",l.DEVOLUCION="DEVOLUCION",l}(F||{}),g=function(l){return l.STOCK_BAJO="STOCK_BAJO",l.PRODUCTO_VENCIDO="PRODUCTO_VENCIDO",l.PRODUCTO_POR_VENCER="PRODUCTO_POR_VENCER",l.STOCK_AGOTADO="STOCK_AGOTADO",l}(g||{})},6241:(k,M,i)=>{i.d(M,{b:()=>t});var A=i(4412),F=i(7673),g=i(8810),l=i(6354),O=i(8384),E=i(2181),j=i(4438),S=i(7156);let t=(()=>{class T{constructor(a){this.http=a,this.products=new A.t([]),this.movements=new A.t([]),this.alerts=new A.t([]),this.products$=this.products.asObservable(),this.movements$=this.movements.asObservable(),this.alerts$=this.alerts.asObservable(),this.loadDemoData()}loadDemoData(){const a=[{id:"1",nombre:"Laptop HP Pavilion",descripcion:"Laptop HP Pavilion 15.6 pulgadas, 8GB RAM, 256GB SSD",precio:899.99,proveedor:"HP Inc.",cantidad:15,codigo1:"HP-LAP-001",codigo2:"PAV-156-8256",imagenes:["laptop-hp.jpg"],rubro:"Electr\xf3nicos",categoria:"Computadoras",marca:"HP",fechaVencimiento:void 0,lote:"LOT-2024-001",status:E.Sz.ACTIVO,notas:"Modelo m\xe1s vendido de la marca",ubicacion:"Almac\xe9n A - Estante 1",fechaCreacion:new Date("2024-01-15"),fechaActualizacion:new Date("2024-01-20")},{id:"2",nombre:"Mouse Inal\xe1mbrico Logitech",descripcion:"Mouse inal\xe1mbrico Logitech MX Master 3",precio:79.99,proveedor:"Logitech",cantidad:5,codigo1:"LOG-MOU-001",codigo2:"MX-MST-3",imagenes:["mouse-logitech.jpg"],rubro:"Electr\xf3nicos",categoria:"Accesorios",marca:"Logitech",fechaVencimiento:void 0,lote:"LOT-2024-002",status:E.Sz.ACTIVO,notas:"Stock bajo - reabastecer pronto",ubicacion:"Almac\xe9n A - Estante 2",fechaCreacion:new Date("2024-01-10"),fechaActualizacion:new Date("2024-01-18")},{id:"3",nombre:"Medicamento Paracetamol",descripcion:"Paracetamol 500mg - Caja con 20 tabletas",precio:5.99,proveedor:"Farmac\xe9utica ABC",cantidad:0,codigo1:"MED-PAR-001",codigo2:"PAR-500-20",imagenes:["paracetamol.jpg"],rubro:"Farmacia",categoria:"Analg\xe9sicos",marca:"Gen\xe9rico",fechaVencimiento:new Date("2024-12-31"),lote:"LOT-2024-003",status:E.Sz.AGOTADO,notas:"Producto agotado - pedido urgente",ubicacion:"Farmacia - Estante B",fechaCreacion:new Date("2024-01-05"),fechaActualizacion:new Date("2024-01-22")}],r=[{id:"1",productId:"1",tipo:E.UB.ENTRADA,cantidad:20,cantidadAnterior:0,cantidadNueva:20,motivo:"Compra inicial de inventario",usuario:"admin@inventory.com",fecha:new Date("2024-01-15"),lote:"LOT-2024-001",ubicacion:"Almac\xe9n A - Estante 1"},{id:"2",productId:"1",tipo:E.UB.SALIDA,cantidad:5,cantidadAnterior:20,cantidadNueva:15,motivo:"Venta al cliente",usuario:"manager@inventory.com",fecha:new Date("2024-01-20"),lote:"LOT-2024-001",ubicacion:"Almac\xe9n A - Estante 1"}],u=[{id:"1",productId:"2",tipo:E.vT.STOCK_BAJO,message:"Stock bajo: Mouse Inal\xe1mbrico Logitech (5 unidades)",fecha:new Date,leido:!1},{id:"2",productId:"3",tipo:E.vT.STOCK_AGOTADO,message:"Stock agotado: Medicamento Paracetamol",fecha:new Date,leido:!1}];this.products.next(a),this.movements.next(r),this.alerts.next(u)}getProducts(){return this.products$}getProduct(a){return this.products$.pipe((0,l.T)(r=>r.find(u=>u.id===a)))}createProduct(a){const r={id:this.generateId(),...a,precio:Number(a.precio),cantidad:Number(a.cantidad),imagenes:[],fechaVencimiento:a.fechaVencimiento?new Date(a.fechaVencimiento):void 0,fechaCreacion:new Date,fechaActualizacion:new Date};return this.products.next([...this.products.value,r]),this.addInventoryMovement({productId:r.id,tipo:E.UB.ENTRADA,cantidad:r.cantidad,cantidadAnterior:0,cantidadNueva:r.cantidad,motivo:"Creaci\xf3n de producto",usuario:"current-user",fecha:new Date,lote:r.lote,ubicacion:r.ubicacion}),(0,F.of)(r).pipe((0,O.c)(500))}updateProduct(a,r){const u=this.products.value,C=u.findIndex(I=>I.id===a);if(-1===C)return(0,g.$)(()=>new Error("Producto no encontrado"));const x=u[C],p={...x,...r,precio:Number(r.precio),cantidad:Number(r.cantidad),fechaVencimiento:r.fechaVencimiento?new Date(r.fechaVencimiento):void 0,fechaActualizacion:new Date};if(x.cantidad!==p.cantidad){const I=p.cantidad-x.cantidad;this.addInventoryMovement({productId:a,tipo:I>0?E.UB.ENTRADA:E.UB.SALIDA,cantidad:Math.abs(I),cantidadAnterior:x.cantidad,cantidadNueva:p.cantidad,motivo:"Ajuste de inventario",usuario:"current-user",fecha:new Date,lote:p.lote,ubicacion:p.ubicacion})}return u[C]=p,this.products.next([...u]),(0,F.of)(p).pipe((0,O.c)(500))}deleteProduct(a){const u=this.products.value.filter(C=>C.id!==a);return this.products.next(u),(0,F.of)(!0).pipe((0,O.c)(500))}getInventoryMovements(){return this.movements$}addInventoryMovement(a){const r={id:this.generateId(),...a};this.movements.next([r,...this.movements.value])}getStockAlerts(){return this.alerts$}markAlertAsRead(a){const r=this.alerts.value,u=r.findIndex(C=>C.id===a);return-1!==u&&(r[u].leido=!0,this.alerts.next([...r])),(0,F.of)(!0)}generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,5)}searchProducts(a){return this.products$.pipe((0,l.T)(r=>r.filter(u=>u.nombre.toLowerCase().includes(a.toLowerCase())||u.codigo1.toLowerCase().includes(a.toLowerCase())||u.codigo2.toLowerCase().includes(a.toLowerCase())||u.marca.toLowerCase().includes(a.toLowerCase()))))}getProductsByCategory(a){return this.products$.pipe((0,l.T)(r=>r.filter(u=>u.categoria===a)))}getLowStockProducts(a=10){return this.products$.pipe((0,l.T)(r=>r.filter(u=>u.cantidad<=a)))}static{this.\u0275fac=function(r){return new(r||T)(j.KVO(S.Qq))}}static{this.\u0275prov=j.jDH({token:T,factory:T.\u0275fac,providedIn:"root"})}}return T})()},8384:(k,M,i)=>{i.d(M,{c:()=>D});var A=i(8359);class F extends A.yU{constructor(n,o){super()}schedule(n,o=0){return this}}const g={setInterval(m,n,...o){const{delegate:d}=g;return d?.setInterval?d.setInterval(m,n,...o):setInterval(m,n,...o)},clearInterval(m){const{delegate:n}=g;return(n?.clearInterval||clearInterval)(m)},delegate:void 0};var l=i(7908);const E={now:()=>(E.delegate||Date).now(),delegate:void 0};class j{constructor(n,o=j.now){this.schedulerActionCtor=n,this.now=o}schedule(n,o=0,d){return new this.schedulerActionCtor(this,n).schedule(d,o)}}j.now=E.now;const t=new class S extends j{constructor(n,o=j.now){super(n,o),this.actions=[],this._active=!1}flush(n){const{actions:o}=this;if(this._active)return void o.push(n);let d;this._active=!0;do{if(d=n.execute(n.state,n.delay))break}while(n=o.shift());if(this._active=!1,d){for(;n=o.shift();)n.unsubscribe();throw d}}}(class O extends F{constructor(n,o){super(n,o),this.scheduler=n,this.work=o,this.pending=!1}schedule(n,o=0){var d;if(this.closed)return this;this.state=n;const y=this.id,b=this.scheduler;return null!=y&&(this.id=this.recycleAsyncId(b,y,o)),this.pending=!0,this.delay=o,this.id=null!==(d=this.id)&&void 0!==d?d:this.requestAsyncId(b,this.id,o),this}requestAsyncId(n,o,d=0){return g.setInterval(n.flush.bind(n,this),d)}recycleAsyncId(n,o,d=0){if(null!=d&&this.delay===d&&!1===this.pending)return o;null!=o&&g.clearInterval(o)}execute(n,o){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const d=this._execute(n,o);if(d)return d;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,o){let y,d=!1;try{this.work(n)}catch(b){d=!0,y=b||new Error("Scheduled action threw falsy error")}if(d)return this.unsubscribe(),y}unsubscribe(){if(!this.closed){const{id:n,scheduler:o}=this,{actions:d}=o;this.work=this.state=this.scheduler=null,this.pending=!1,(0,l.o)(d,this),null!=n&&(this.id=this.recycleAsyncId(o,n,null)),this.delay=null,super.unsubscribe()}}}),T=t;var _=i(8793),a=i(6697),r=i(9974),u=i(4360),C=i(5343),p=i(3703),I=i(1397),e=i(8750);function v(m,n){return n?o=>(0,_.x)(n.pipe((0,a.s)(1),function x(){return(0,r.N)((m,n)=>{m.subscribe((0,u._)(n,C.l))})}()),o.pipe(v(m))):(0,I.Z)((o,d)=>(0,e.Tg)(m(o,d)).pipe((0,a.s)(1),(0,p.u)(o)))}var s=i(1985),h=i(9470);function D(m,n=t){const o=function f(m=0,n,o=T){let d=-1;return null!=n&&((0,h.m)(n)?o=n:d=n),new s.c(y=>{let b=function c(m){return m instanceof Date&&!isNaN(m)}(m)?+m-o.now():m;b<0&&(b=0);let R=0;return o.schedule(function(){y.closed||(y.next(R++),0<=d?this.schedule(void 0,d):y.complete())},b)})}(m,n);return v(()=>o)}}}]);