"use strict";(self.webpackChunkrecuento_inventory=self.webpackChunkrecuento_inventory||[]).push([[305],{2305:(T,P,r)=>{r.r(P),r.d(P,{ProductListComponent:()=>b});var E=r(177),A=r(8094),f=r(4341),d=r(4412),M=r(4572),v=r(6354),j=r(9172),e=r(4438),_=r(6241);const O=(u,C,n,m)=>({"bg-red-100 text-red-800":u,"bg-yellow-100 text-yellow-800":C,"bg-orange-100 text-orange-800":n,"bg-green-100 text-green-800":m}),y=(u,C,n,m,s)=>({"bg-green-100 text-green-800":u,"bg-gray-100 text-gray-800":C,"bg-red-100 text-red-800":n,"bg-purple-100 text-purple-800":m,"bg-blue-100 text-blue-800":s}),a=u=>["/productos",u,"editar"];function i(u,C){if(1&u&&(e.j41(0,"option",43),e.EFF(1),e.k0s()),2&u){const n=C.$implicit;e.Y8G("value",n),e.R7$(),e.SpI(" ",n," ")}}function l(u,C){1&u&&(e.j41(0,"tr")(1,"td",44)(2,"div",45),e.qSk(),e.j41(3,"svg",46),e.nrm(4,"path",47),e.k0s(),e.joV(),e.j41(5,"p"),e.EFF(6,"No se encontraron productos"),e.k0s(),e.j41(7,"p",48),e.EFF(8," Ajusta los filtros o agrega nuevos productos "),e.k0s()()()())}function I(u,C){if(1&u){const n=e.RV6();e.j41(0,"tr")(1,"td")(2,"div",49)(3,"div",50)(4,"div",51),e.qSk(),e.j41(5,"svg",52),e.nrm(6,"path",27)(7,"path",28),e.k0s()()(),e.joV(),e.j41(8,"div")(9,"p",53),e.EFF(10),e.k0s(),e.j41(11,"p",54),e.EFF(12),e.k0s()()()(),e.j41(13,"td")(14,"div")(15,"p",55),e.EFF(16),e.k0s(),e.j41(17,"p",56),e.EFF(18),e.k0s()()(),e.j41(19,"td")(20,"div")(21,"p",55),e.EFF(22),e.k0s(),e.j41(23,"p",56),e.EFF(24),e.k0s()()(),e.j41(25,"td")(26,"span",57),e.EFF(27),e.k0s()(),e.j41(28,"td",55),e.EFF(29),e.nI1(30,"number"),e.k0s(),e.j41(31,"td")(32,"span",57),e.EFF(33),e.k0s()(),e.j41(34,"td",54),e.EFF(35),e.k0s(),e.j41(36,"td")(37,"div",58)(38,"a",59),e.qSk(),e.j41(39,"svg",60),e.nrm(40,"path",61),e.k0s()(),e.joV(),e.j41(41,"button",62),e.bIt("click",function(){const s=e.eBV(n).$implicit,p=e.XpG();return e.Njj(p.deleteProduct(s))}),e.qSk(),e.j41(42,"svg",60),e.nrm(43,"path",63),e.k0s()()()()()}if(2&u){const n=C.$implicit;e.R7$(10),e.SpI(" ",n.nombre," "),e.R7$(2),e.JRh(n.marca),e.R7$(4),e.JRh(n.codigo1),e.R7$(2),e.JRh(n.codigo2),e.R7$(4),e.JRh(n.categoria),e.R7$(2),e.JRh(n.rubro),e.R7$(2),e.Y8G("ngClass",e.ziG(16,O,0===n.cantidad,n.cantidad>0&&n.cantidad<=5,n.cantidad>5&&n.cantidad<=10,n.cantidad>10)),e.R7$(),e.SpI(" ",n.cantidad," "),e.R7$(2),e.SpI(" $",e.i5U(30,13,n.precio,"1.2-2")," "),e.R7$(3),e.Y8G("ngClass",e.s1E(21,y,"ACTIVO"===n.status,"INACTIVO"===n.status,"AGOTADO"===n.status,"VENCIDO"===n.status,"RESERVADO"===n.status)),e.R7$(),e.SpI(" ",n.status," "),e.R7$(2),e.JRh(n.ubicacion),e.R7$(3),e.Y8G("routerLink",e.eq3(27,a,n.id))}}let b=(()=>{class u{constructor(n){this.productService=n,this.searchSubject=new d.t(""),this.categorySubject=new d.t(""),this.statusSubject=new d.t(""),this.searchQuery="",this.selectedCategory="",this.selectedStatus="",this.products$=this.productService.getProducts(),this.categories$=this.products$.pipe((0,v.T)(m=>[...new Set(m.map(s=>s.categoria))].sort())),this.filteredProducts$=(0,M.z)([this.products$,this.searchSubject.pipe((0,j.Z)("")),this.categorySubject.pipe((0,j.Z)("")),this.statusSubject.pipe((0,j.Z)(""))]).pipe((0,v.T)(([m,s,p,h])=>m.filter(D=>(!s||D.nombre.toLowerCase().includes(s.toLowerCase())||D.codigo1.toLowerCase().includes(s.toLowerCase())||D.codigo2.toLowerCase().includes(s.toLowerCase())||D.marca.toLowerCase().includes(s.toLowerCase()))&&(!p||D.categoria===p)&&(!h||D.status===h)))),this.totalValue$=this.filteredProducts$.pipe((0,v.T)(m=>m.reduce((s,p)=>s+p.precio*p.cantidad,0))),this.lowStockCount$=this.filteredProducts$.pipe((0,v.T)(m=>m.filter(s=>s.cantidad<=10).length))}ngOnInit(){}onSearchChange(n){this.searchSubject.next(n)}onCategoryChange(n){this.categorySubject.next(n)}onStatusChange(n){this.statusSubject.next(n)}clearFilters(){this.searchQuery="",this.selectedCategory="",this.selectedStatus="",this.searchSubject.next(""),this.categorySubject.next(""),this.statusSubject.next("")}deleteProduct(n){confirm(`\xbfEst\xe1s seguro de que deseas eliminar el producto "${n.nombre}"?`)&&this.productService.deleteProduct(n.id).subscribe({next:()=>{console.log("Producto eliminado exitosamente")},error:m=>{console.error("Error al eliminar producto:",m),alert("Error al eliminar el producto. Intenta de nuevo.")}})}static{this.\u0275fac=function(m){return new(m||u)(e.rXU(_.b))}}static{this.\u0275cmp=e.VBU({type:u,selectors:[["app-product-list"]],standalone:!0,features:[e.aNF],decls:108,vars:24,consts:[[1,"space-y-6"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],["routerLink","/productos/nuevo",1,"btn","btn-primary","flex","items-center","space-x-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 6v6m0 0v6m0-6h6m-6 0H6"],[1,"card","p-4"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","placeholder","Nombre, c\xf3digo, marca...",1,"input",3,"ngModelChange","ngModel"],[1,"input",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["value","ACTIVO"],["value","INACTIVO"],["value","AGOTADO"],["value","VENCIDO"],["value","RESERVADO"],[1,"flex","items-end"],["type","button",1,"btn","btn-secondary","w-full",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-xl","font-bold","text-gray-900"],[1,"w-8","h-8","bg-blue-100","rounded-lg","flex","items-center","justify-center"],["fill","currentColor","viewBox","0 0 20 20",1,"w-4","h-4","text-blue-600"],["fill-rule","evenodd","d","M4 3a2 2 0 100 4h12a2 2 0 100-4H4z"],["fill-rule","evenodd","d","M3 8h14v7a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z","clip-rule","evenodd"],[1,"w-8","h-8","bg-green-100","rounded-lg","flex","items-center","justify-center"],["fill","currentColor","viewBox","0 0 20 20",1,"w-4","h-4","text-green-600"],["d","M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z","clip-rule","evenodd"],[1,"text-xl","font-bold","text-red-600"],[1,"w-8","h-8","bg-red-100","rounded-lg","flex","items-center","justify-center"],["fill","currentColor","viewBox","0 0 20 20",1,"w-4","h-4","text-red-600"],["fill-rule","evenodd","d","M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule","evenodd"],[1,"card","overflow-hidden"],[1,"overflow-x-auto"],[1,"table"],[1,"bg-gray-50"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"value"],["colspan","8",1,"text-center","py-8","text-gray-500"],[1,"flex","flex-col","items-center"],["fill","currentColor","viewBox","0 0 20 20",1,"w-12","h-12","mb-3","text-gray-300"],["fill-rule","evenodd","d","M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"text-sm"],[1,"flex","items-center","space-x-3"],[1,"flex-shrink-0"],[1,"w-10","h-10","bg-gray-200","rounded-lg","flex","items-center","justify-center"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","text-gray-500"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-sm","text-gray-500"],[1,"text-sm","text-gray-900"],[1,"text-xs","text-gray-500"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium",3,"ngClass"],[1,"flex","items-center","space-x-2"],["title","Editar",1,"text-primary-600","hover:text-primary-900","text-sm",3,"routerLink"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["title","Eliminar",1,"text-red-600","hover:text-red-900","text-sm",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1-1H8a1 1 0 00-1 1v3M4 7h16"]],template:function(m,s){if(1&m&&(e.j41(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),e.EFF(4,"Productos"),e.k0s(),e.j41(5,"p",3),e.EFF(6,"Gesti\xf3n del cat\xe1logo de productos"),e.k0s()(),e.j41(7,"a",4),e.qSk(),e.j41(8,"svg",5),e.nrm(9,"path",6),e.k0s(),e.joV(),e.j41(10,"span"),e.EFF(11,"Nuevo Producto"),e.k0s()()(),e.j41(12,"div",7)(13,"div",8)(14,"div")(15,"label",9),e.EFF(16," Buscar "),e.k0s(),e.j41(17,"input",10),e.mxI("ngModelChange",function(h){return e.DH7(s.searchQuery,h)||(s.searchQuery=h),h}),e.bIt("ngModelChange",function(h){return s.onSearchChange(h)}),e.k0s()(),e.j41(18,"div")(19,"label",9),e.EFF(20," Categor\xeda "),e.k0s(),e.j41(21,"select",11),e.mxI("ngModelChange",function(h){return e.DH7(s.selectedCategory,h)||(s.selectedCategory=h),h}),e.bIt("ngModelChange",function(h){return s.onCategoryChange(h)}),e.j41(22,"option",12),e.EFF(23,"Todas las categor\xedas"),e.k0s(),e.DNE(24,i,2,2,"option",13),e.nI1(25,"async"),e.k0s()(),e.j41(26,"div")(27,"label",9),e.EFF(28," Estado "),e.k0s(),e.j41(29,"select",11),e.mxI("ngModelChange",function(h){return e.DH7(s.selectedStatus,h)||(s.selectedStatus=h),h}),e.bIt("ngModelChange",function(h){return s.onStatusChange(h)}),e.j41(30,"option",12),e.EFF(31,"Todos los estados"),e.k0s(),e.j41(32,"option",14),e.EFF(33,"Activo"),e.k0s(),e.j41(34,"option",15),e.EFF(35,"Inactivo"),e.k0s(),e.j41(36,"option",16),e.EFF(37,"Agotado"),e.k0s(),e.j41(38,"option",17),e.EFF(39,"Vencido"),e.k0s(),e.j41(40,"option",18),e.EFF(41,"Reservado"),e.k0s()()(),e.j41(42,"div",19)(43,"button",20),e.bIt("click",function(){return s.clearFilters()}),e.EFF(44," Limpiar Filtros "),e.k0s()()()(),e.j41(45,"div",21)(46,"div",7)(47,"div",22)(48,"div")(49,"p",23),e.EFF(50,"Total Productos"),e.k0s(),e.j41(51,"p",24),e.EFF(52),e.nI1(53,"async"),e.k0s()(),e.j41(54,"div",25),e.qSk(),e.j41(55,"svg",26),e.nrm(56,"path",27)(57,"path",28),e.k0s()()()(),e.joV(),e.j41(58,"div",7)(59,"div",22)(60,"div")(61,"p",23),e.EFF(62,"Valor Total"),e.k0s(),e.j41(63,"p",24),e.EFF(64),e.nI1(65,"async"),e.nI1(66,"number"),e.k0s()(),e.j41(67,"div",29),e.qSk(),e.j41(68,"svg",30),e.nrm(69,"path",31)(70,"path",32),e.k0s()()()(),e.joV(),e.j41(71,"div",7)(72,"div",22)(73,"div")(74,"p",23),e.EFF(75,"Stock Bajo"),e.k0s(),e.j41(76,"p",33),e.EFF(77),e.nI1(78,"async"),e.k0s()(),e.j41(79,"div",34),e.qSk(),e.j41(80,"svg",35),e.nrm(81,"path",36),e.k0s()()()()(),e.joV(),e.j41(82,"div",37)(83,"div",38)(84,"table",39)(85,"thead",40)(86,"tr")(87,"th"),e.EFF(88,"Producto"),e.k0s(),e.j41(89,"th"),e.EFF(90,"C\xf3digo"),e.k0s(),e.j41(91,"th"),e.EFF(92,"Categor\xeda"),e.k0s(),e.j41(93,"th"),e.EFF(94,"Stock"),e.k0s(),e.j41(95,"th"),e.EFF(96,"Precio"),e.k0s(),e.j41(97,"th"),e.EFF(98,"Estado"),e.k0s(),e.j41(99,"th"),e.EFF(100,"Ubicaci\xf3n"),e.k0s(),e.j41(101,"th"),e.EFF(102,"Acciones"),e.k0s()()(),e.j41(103,"tbody"),e.DNE(104,l,9,0,"tr",41),e.nI1(105,"async"),e.DNE(106,I,44,29,"tr",42),e.nI1(107,"async"),e.k0s()()()()()),2&m){let p,h;e.R7$(17),e.R50("ngModel",s.searchQuery),e.R7$(4),e.R50("ngModel",s.selectedCategory),e.R7$(3),e.Y8G("ngForOf",e.bMT(25,9,s.categories$)),e.R7$(5),e.R50("ngModel",s.selectedStatus),e.R7$(23),e.SpI(" ",(null==(p=e.bMT(53,11,s.filteredProducts$))?null:p.length)||0," "),e.R7$(12),e.SpI(" $",e.i5U(66,15,e.bMT(65,13,s.totalValue$),"1.2-2")," "),e.R7$(13),e.SpI(" ",e.bMT(78,18,s.lowStockCount$)," "),e.R7$(27),e.Y8G("ngIf",0===(null==(h=e.bMT(105,20,s.filteredProducts$))?null:h.length)),e.R7$(2),e.Y8G("ngForOf",e.bMT(107,22,s.filteredProducts$))}},dependencies:[E.MD,E.YU,E.Sq,E.bT,E.Jj,E.QX,A.iI,A.Wk,f.YN,f.xH,f.y7,f.me,f.wz,f.BC,f.vS],encapsulation:2})}}return u})()},2181:(T,P,r)=>{r.d(P,{Sz:()=>E,UB:()=>A,vT:()=>f});var E=function(d){return d.ACTIVO="ACTIVO",d.INACTIVO="INACTIVO",d.AGOTADO="AGOTADO",d.VENCIDO="VENCIDO",d.RESERVADO="RESERVADO",d}(E||{}),A=function(d){return d.ENTRADA="ENTRADA",d.SALIDA="SALIDA",d.AJUSTE="AJUSTE",d.TRANSFERENCIA="TRANSFERENCIA",d.DEVOLUCION="DEVOLUCION",d}(A||{}),f=function(d){return d.STOCK_BAJO="STOCK_BAJO",d.PRODUCTO_VENCIDO="PRODUCTO_VENCIDO",d.PRODUCTO_POR_VENCER="PRODUCTO_POR_VENCER",d.STOCK_AGOTADO="STOCK_AGOTADO",d}(f||{})},6241:(T,P,r)=>{r.d(P,{b:()=>_});var E=r(4412),A=r(7673),f=r(8810),d=r(6354),M=r(8384),v=r(2181),j=r(4438),e=r(7156);let _=(()=>{class O{constructor(a){this.http=a,this.products=new E.t([]),this.movements=new E.t([]),this.alerts=new E.t([]),this.products$=this.products.asObservable(),this.movements$=this.movements.asObservable(),this.alerts$=this.alerts.asObservable(),this.loadDemoData()}loadDemoData(){const a=[{id:"1",nombre:"Laptop HP Pavilion",descripcion:"Laptop HP Pavilion 15.6 pulgadas, 8GB RAM, 256GB SSD",precio:899.99,proveedor:"HP Inc.",cantidad:15,codigo1:"HP-LAP-001",codigo2:"PAV-156-8256",imagenes:["laptop-hp.jpg"],rubro:"Electr\xf3nicos",categoria:"Computadoras",marca:"HP",fechaVencimiento:void 0,lote:"LOT-2024-001",status:v.Sz.ACTIVO,notas:"Modelo m\xe1s vendido de la marca",ubicacion:"Almac\xe9n A - Estante 1",fechaCreacion:new Date("2024-01-15"),fechaActualizacion:new Date("2024-01-20")},{id:"2",nombre:"Mouse Inal\xe1mbrico Logitech",descripcion:"Mouse inal\xe1mbrico Logitech MX Master 3",precio:79.99,proveedor:"Logitech",cantidad:5,codigo1:"LOG-MOU-001",codigo2:"MX-MST-3",imagenes:["mouse-logitech.jpg"],rubro:"Electr\xf3nicos",categoria:"Accesorios",marca:"Logitech",fechaVencimiento:void 0,lote:"LOT-2024-002",status:v.Sz.ACTIVO,notas:"Stock bajo - reabastecer pronto",ubicacion:"Almac\xe9n A - Estante 2",fechaCreacion:new Date("2024-01-10"),fechaActualizacion:new Date("2024-01-18")},{id:"3",nombre:"Medicamento Paracetamol",descripcion:"Paracetamol 500mg - Caja con 20 tabletas",precio:5.99,proveedor:"Farmac\xe9utica ABC",cantidad:0,codigo1:"MED-PAR-001",codigo2:"PAR-500-20",imagenes:["paracetamol.jpg"],rubro:"Farmacia",categoria:"Analg\xe9sicos",marca:"Gen\xe9rico",fechaVencimiento:new Date("2024-12-31"),lote:"LOT-2024-003",status:v.Sz.AGOTADO,notas:"Producto agotado - pedido urgente",ubicacion:"Farmacia - Estante B",fechaCreacion:new Date("2024-01-05"),fechaActualizacion:new Date("2024-01-22")}],i=[{id:"1",productId:"1",tipo:v.UB.ENTRADA,cantidad:20,cantidadAnterior:0,cantidadNueva:20,motivo:"Compra inicial de inventario",usuario:"admin@inventory.com",fecha:new Date("2024-01-15"),lote:"LOT-2024-001",ubicacion:"Almac\xe9n A - Estante 1"},{id:"2",productId:"1",tipo:v.UB.SALIDA,cantidad:5,cantidadAnterior:20,cantidadNueva:15,motivo:"Venta al cliente",usuario:"manager@inventory.com",fecha:new Date("2024-01-20"),lote:"LOT-2024-001",ubicacion:"Almac\xe9n A - Estante 1"}],l=[{id:"1",productId:"2",tipo:v.vT.STOCK_BAJO,message:"Stock bajo: Mouse Inal\xe1mbrico Logitech (5 unidades)",fecha:new Date,leido:!1},{id:"2",productId:"3",tipo:v.vT.STOCK_AGOTADO,message:"Stock agotado: Medicamento Paracetamol",fecha:new Date,leido:!1}];this.products.next(a),this.movements.next(i),this.alerts.next(l)}getProducts(){return this.products$}getProduct(a){return this.products$.pipe((0,d.T)(i=>i.find(l=>l.id===a)))}createProduct(a){const i={id:this.generateId(),...a,precio:Number(a.precio),cantidad:Number(a.cantidad),imagenes:[],fechaVencimiento:a.fechaVencimiento?new Date(a.fechaVencimiento):void 0,fechaCreacion:new Date,fechaActualizacion:new Date};return this.products.next([...this.products.value,i]),this.addInventoryMovement({productId:i.id,tipo:v.UB.ENTRADA,cantidad:i.cantidad,cantidadAnterior:0,cantidadNueva:i.cantidad,motivo:"Creaci\xf3n de producto",usuario:"current-user",fecha:new Date,lote:i.lote,ubicacion:i.ubicacion}),(0,A.of)(i).pipe((0,M.c)(500))}updateProduct(a,i){const l=this.products.value,I=l.findIndex(C=>C.id===a);if(-1===I)return(0,f.$)(()=>new Error("Producto no encontrado"));const b=l[I],u={...b,...i,precio:Number(i.precio),cantidad:Number(i.cantidad),fechaVencimiento:i.fechaVencimiento?new Date(i.fechaVencimiento):void 0,fechaActualizacion:new Date};if(b.cantidad!==u.cantidad){const C=u.cantidad-b.cantidad;this.addInventoryMovement({productId:a,tipo:C>0?v.UB.ENTRADA:v.UB.SALIDA,cantidad:Math.abs(C),cantidadAnterior:b.cantidad,cantidadNueva:u.cantidad,motivo:"Ajuste de inventario",usuario:"current-user",fecha:new Date,lote:u.lote,ubicacion:u.ubicacion})}return l[I]=u,this.products.next([...l]),(0,A.of)(u).pipe((0,M.c)(500))}deleteProduct(a){const l=this.products.value.filter(I=>I.id!==a);return this.products.next(l),(0,A.of)(!0).pipe((0,M.c)(500))}getInventoryMovements(){return this.movements$}addInventoryMovement(a){const i={id:this.generateId(),...a};this.movements.next([i,...this.movements.value])}getStockAlerts(){return this.alerts$}markAlertAsRead(a){const i=this.alerts.value,l=i.findIndex(I=>I.id===a);return-1!==l&&(i[l].leido=!0,this.alerts.next([...i])),(0,A.of)(!0)}generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,5)}searchProducts(a){return this.products$.pipe((0,d.T)(i=>i.filter(l=>l.nombre.toLowerCase().includes(a.toLowerCase())||l.codigo1.toLowerCase().includes(a.toLowerCase())||l.codigo2.toLowerCase().includes(a.toLowerCase())||l.marca.toLowerCase().includes(a.toLowerCase()))))}getProductsByCategory(a){return this.products$.pipe((0,d.T)(i=>i.filter(l=>l.categoria===a)))}getLowStockProducts(a=10){return this.products$.pipe((0,d.T)(i=>i.filter(l=>l.cantidad<=a)))}static{this.\u0275fac=function(i){return new(i||O)(j.KVO(e.Qq))}}static{this.\u0275prov=j.jDH({token:O,factory:O.\u0275fac,providedIn:"root"})}}return O})()},8384:(T,P,r)=>{r.d(P,{c:()=>R});var E=r(8359);class A extends E.yU{constructor(t,o){super()}schedule(t,o=0){return this}}const f={setInterval(g,t,...o){const{delegate:c}=f;return c?.setInterval?c.setInterval(g,t,...o):setInterval(g,t,...o)},clearInterval(g){const{delegate:t}=f;return(t?.clearInterval||clearInterval)(g)},delegate:void 0};var d=r(7908);const v={now:()=>(v.delegate||Date).now(),delegate:void 0};class j{constructor(t,o=j.now){this.schedulerActionCtor=t,this.now=o}schedule(t,o=0,c){return new this.schedulerActionCtor(this,t).schedule(c,o)}}j.now=v.now;const _=new class e extends j{constructor(t,o=j.now){super(t,o),this.actions=[],this._active=!1}flush(t){const{actions:o}=this;if(this._active)return void o.push(t);let c;this._active=!0;do{if(c=t.execute(t.state,t.delay))break}while(t=o.shift());if(this._active=!1,c){for(;t=o.shift();)t.unsubscribe();throw c}}}(class M extends A{constructor(t,o){super(t,o),this.scheduler=t,this.work=o,this.pending=!1}schedule(t,o=0){var c;if(this.closed)return this;this.state=t;const F=this.id,x=this.scheduler;return null!=F&&(this.id=this.recycleAsyncId(x,F,o)),this.pending=!0,this.delay=o,this.id=null!==(c=this.id)&&void 0!==c?c:this.requestAsyncId(x,this.id,o),this}requestAsyncId(t,o,c=0){return f.setInterval(t.flush.bind(t,this),c)}recycleAsyncId(t,o,c=0){if(null!=c&&this.delay===c&&!1===this.pending)return o;null!=o&&f.clearInterval(o)}execute(t,o){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const c=this._execute(t,o);if(c)return c;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,o){let F,c=!1;try{this.work(t)}catch(x){c=!0,F=x||new Error("Scheduled action threw falsy error")}if(c)return this.unsubscribe(),F}unsubscribe(){if(!this.closed){const{id:t,scheduler:o}=this,{actions:c}=o;this.work=this.state=this.scheduler=null,this.pending=!1,(0,d.o)(c,this),null!=t&&(this.id=this.recycleAsyncId(o,t,null)),this.delay=null,super.unsubscribe()}}}),O=_;var y=r(8793),a=r(6697),i=r(9974),l=r(4360),I=r(5343),u=r(3703),C=r(1397),n=r(8750);function m(g,t){return t?o=>(0,y.x)(t.pipe((0,a.s)(1),function b(){return(0,i.N)((g,t)=>{g.subscribe((0,l._)(t,I.l))})}()),o.pipe(m(g))):(0,C.Z)((o,c)=>(0,n.Tg)(g(o,c)).pipe((0,a.s)(1),(0,u.u)(o)))}var s=r(1985),p=r(9470);function R(g,t=_){const o=function D(g=0,t,o=O){let c=-1;return null!=t&&((0,p.m)(t)?o=t:c=t),new s.c(F=>{let x=function h(g){return g instanceof Date&&!isNaN(g)}(g)?+g-o.now():g;x<0&&(x=0);let S=0;return o.schedule(function(){F.closed||(F.next(S++),0<=c?this.schedule(void 0,c):F.complete())},x)})}(g,t);return m(()=>o)}}}]);