"use strict";(self.webpackChunkrecuento_inventory=self.webpackChunkrecuento_inventory||[]).push([[629],{5629:(_,O,d)=>{d.r(O),d.d(O,{InventoryComponent:()=>T});var v=d(177),g=d(8094),f=d(6354),t=d(4438),j=d(6241);const h=(i,u)=>({"bg-red-100":i,"bg-yellow-100":u}),y=(i,u)=>({"text-red-600":i,"text-yellow-600":u}),F=(i,u,e)=>({"bg-green-100 text-green-800":i,"bg-yellow-100 text-yellow-800":u,"bg-red-100 text-red-800":e}),k=(i,u)=>({"text-red-600":i,"text-green-600":u}),I=(i,u,e)=>({"bg-red-100 text-red-800":i,"bg-yellow-100 text-yellow-800":u,"bg-orange-100 text-orange-800":e});function R(i,u){if(1&i){const e=t.RV6();t.j41(0,"button",50),t.bIt("click",function(){t.eBV(e);const m=t.XpG().$implicit,r=t.XpG(2);return t.Njj(r.markAlertAsRead(m.id))}),t.EFF(1," Marcar como le\xeddo "),t.k0s()}}function c(i,u){if(1&i&&(t.j41(0,"div",42)(1,"div",43)(2,"div",44),t.qSk(),t.j41(3,"svg",45),t.nrm(4,"path",40),t.k0s()(),t.joV(),t.j41(5,"div",46)(6,"p",47),t.EFF(7),t.k0s(),t.j41(8,"p",48),t.EFF(9),t.nI1(10,"date"),t.k0s()(),t.DNE(11,R,2,0,"button",49),t.k0s()()),2&i){const e=u.$implicit;t.R7$(2),t.Y8G("ngClass",t.l_i(8,h,"STOCK_AGOTADO"===e.tipo||"PRODUCTO_VENCIDO"===e.tipo,"STOCK_BAJO"===e.tipo||"PRODUCTO_POR_VENCER"===e.tipo)),t.R7$(),t.Y8G("ngClass",t.l_i(11,y,"STOCK_AGOTADO"===e.tipo||"PRODUCTO_VENCIDO"===e.tipo,"STOCK_BAJO"===e.tipo||"PRODUCTO_POR_VENCER"===e.tipo)),t.R7$(4),t.JRh(e.message),t.R7$(2),t.SpI(" ",t.i5U(10,5,e.fecha,"dd/MM/yyyy HH:mm")," "),t.R7$(2),t.Y8G("ngIf",!e.leido)}}function a(i,u){if(1&i&&(t.j41(0,"div",9)(1,"div",37)(2,"div",38),t.qSk(),t.j41(3,"svg",39),t.nrm(4,"path",40),t.k0s(),t.joV(),t.j41(5,"h3",11),t.EFF(6," Alertas de Inventario "),t.k0s(),t.j41(7,"span",41),t.EFF(8),t.nI1(9,"async"),t.k0s()()(),t.j41(10,"div",16),t.DNE(11,c,12,14,"div",18),t.nI1(12,"async"),t.k0s()()),2&i){let e;const p=t.XpG();t.R7$(8),t.SpI(" ",null==(e=t.bMT(9,2,p.alerts$))?null:e.length," alertas "),t.R7$(3),t.Y8G("ngForOf",t.bMT(12,4,p.alerts$))}}function l(i,u){if(1&i&&(t.j41(0,"div",51)(1,"div",52)(2,"h4",27),t.EFF(3),t.k0s(),t.j41(4,"span",53),t.EFF(5),t.k0s()(),t.j41(6,"div",54)(7,"div",55)(8,"span",3),t.EFF(9,"Stock Total:"),t.k0s(),t.j41(10,"span",56),t.EFF(11),t.k0s()(),t.j41(12,"div",55)(13,"span",3),t.EFF(14,"Valor Total:"),t.k0s(),t.j41(15,"span",56),t.EFF(16),t.nI1(17,"number"),t.k0s()(),t.j41(18,"div",55)(19,"span",3),t.EFF(20,"Stock Bajo:"),t.k0s(),t.j41(21,"span",57),t.EFF(22),t.k0s()()()()),2&i){const e=u.$implicit;t.R7$(3),t.SpI(" ",e.name," "),t.R7$(),t.Y8G("ngClass",t.sMw(10,F,e.totalStock>50,e.totalStock>10&&e.totalStock<=50,e.totalStock<=10)),t.R7$(),t.SpI(" ",e.productCount," productos "),t.R7$(6),t.JRh(e.totalStock),t.R7$(5),t.SpI(" $",t.i5U(17,7,e.totalValue,"1.2-2")," "),t.R7$(5),t.Y8G("ngClass",t.l_i(14,k,e.lowStockCount>0,0===e.lowStockCount)),t.R7$(),t.SpI(" ",e.lowStockCount," ")}}function E(i,u){1&i&&(t.j41(0,"div",58),t.qSk(),t.j41(1,"svg",59),t.nrm(2,"path",60),t.k0s(),t.joV(),t.j41(3,"p"),t.EFF(4,"No hay productos con stock bajo"),t.k0s()())}function D(i,u){if(1&i&&(t.j41(0,"div",42)(1,"div",61)(2,"div",46)(3,"p",62),t.EFF(4),t.k0s(),t.j41(5,"p",63),t.EFF(6),t.k0s(),t.j41(7,"p",48),t.EFF(8),t.k0s()(),t.j41(9,"div",64)(10,"span",65),t.EFF(11),t.k0s()()()()),2&i){const e=u.$implicit;t.R7$(4),t.SpI(" ",e.nombre," "),t.R7$(2),t.Lme(" ",e.marca," - ",e.codigo1," "),t.R7$(2),t.JRh(e.ubicacion),t.R7$(2),t.Y8G("ngClass",t.sMw(6,I,0===e.cantidad,e.cantidad>0&&e.cantidad<=5,e.cantidad>5&&e.cantidad<=10)),t.R7$(),t.SpI(" ",e.cantidad," unidades ")}}function x(i,u){1&i&&(t.j41(0,"div",66)(1,"a",67),t.EFF(2," Ver todos \u2192 "),t.k0s()())}function b(i,u){1&i&&(t.j41(0,"div",58),t.qSk(),t.j41(1,"svg",59),t.nrm(2,"path",60),t.k0s(),t.joV(),t.j41(3,"p"),t.EFF(4,"No hay productos pr\xf3ximos a vencer"),t.k0s()())}function w(i,u){if(1&i&&(t.j41(0,"div",42)(1,"div",61)(2,"div",46)(3,"p",62),t.EFF(4),t.k0s(),t.j41(5,"p",63),t.EFF(6),t.k0s(),t.j41(7,"p",48),t.EFF(8),t.k0s()(),t.j41(9,"div",64)(10,"p",47),t.EFF(11),t.nI1(12,"date"),t.k0s(),t.j41(13,"span",65),t.EFF(14),t.k0s()()()()),2&i){const e=u.$implicit,p=t.XpG();t.R7$(4),t.SpI(" ",e.nombre," "),t.R7$(2),t.Lme(" ",e.marca," - ",e.codigo1," "),t.R7$(2),t.JRh(e.ubicacion),t.R7$(3),t.SpI(" ",t.i5U(12,7,e.fechaVencimiento,"dd/MM/yyyy")," "),t.R7$(2),t.Y8G("ngClass",p.getExpirationClass(e.fechaVencimiento)),t.R7$(),t.SpI(" ",p.getDaysUntilExpiration(e.fechaVencimiento)," d\xedas ")}}let T=(()=>{class i{constructor(e){this.productService=e,this.products$=this.productService.getProducts(),this.alerts$=this.productService.getStockAlerts(),this.lowStockProducts$=this.productService.getLowStockProducts(),this.expiringProducts$=this.products$.pipe((0,f.T)(p=>p.filter(m=>{if(!m.fechaVencimiento)return!1;const r=new Date,o=new Date(m.fechaVencimiento).getTime()-r.getTime(),s=Math.ceil(o/864e5);return s<=30&&s>0}))),this.categoryStats$=this.products$.pipe((0,f.T)(p=>{const m=new Map;return p.forEach(r=>{const n=r.categoria;m.has(n)||m.set(n,{name:n,productCount:0,totalStock:0,totalValue:0,lowStockCount:0});const o=m.get(n);o.productCount++,o.totalStock+=r.cantidad,o.totalValue+=r.precio*r.cantidad,r.cantidad<=10&&o.lowStockCount++}),Array.from(m.values()).sort((r,n)=>n.totalValue-r.totalValue)}))}ngOnInit(){}markAlertAsRead(e){this.productService.markAlertAsRead(e).subscribe({next:()=>{console.log("Alerta marcada como le\xedda")},error:p=>{console.error("Error al marcar alerta como le\xedda:",p)}})}getDaysUntilExpiration(e){const p=new Date,r=new Date(e).getTime()-p.getTime();return Math.ceil(r/864e5)}getExpirationClass(e){const p=this.getDaysUntilExpiration(e);return p<=7?"bg-red-100 text-red-800":p<=15?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800"}static{this.\u0275fac=function(p){return new(p||i)(t.rXU(j.b))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["app-inventory"]],standalone:!0,features:[t.aNF],decls:79,vars:33,consts:[[1,"space-y-6"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600"],[1,"flex","space-x-3"],["routerLink","/inventario/historial",1,"btn","btn-secondary","flex","items-center","space-x-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],["class","card",4,"ngIf"],[1,"card"],[1,"p-6","border-b","border-gray-200"],[1,"text-lg","font-medium","text-gray-900"],[1,"p-6"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],["class","bg-gray-50 rounded-lg p-4",4,"ngFor","ngForOf"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"divide-y","divide-gray-200"],["class","p-6 text-center text-gray-500",4,"ngIf"],["class","p-4",4,"ngFor","ngForOf"],["class","p-4 bg-gray-50",4,"ngIf"],[1,"card","p-6"],[1,"text-lg","font-medium","text-gray-900","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],["routerLink","/productos/nuevo",1,"flex","items-center","p-4","bg-primary-50","rounded-lg","hover:bg-primary-100","transition-colors","duration-200"],[1,"w-10","h-10","bg-primary-100","rounded-lg","flex","items-center","justify-center","mr-3"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","text-primary-600"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z","clip-rule","evenodd"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-xs","text-gray-600"],["routerLink","/reportes",1,"flex","items-center","p-4","bg-green-50","rounded-lg","hover:bg-green-100","transition-colors","duration-200"],[1,"w-10","h-10","bg-green-100","rounded-lg","flex","items-center","justify-center","mr-3"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","text-green-600"],["d","M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"],["routerLink","/stock",1,"flex","items-center","p-4","bg-purple-50","rounded-lg","hover:bg-purple-100","transition-colors","duration-200"],[1,"w-10","h-10","bg-purple-100","rounded-lg","flex","items-center","justify-center","mr-3"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","text-purple-600"],["d","M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"],[1,"p-4","border-b","border-gray-200"],[1,"flex","items-center","space-x-2"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5","text-red-500"],["fill-rule","evenodd","d","M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule","evenodd"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-red-100","text-red-800"],[1,"p-4"],[1,"flex","items-start","space-x-3"],[1,"flex-shrink-0","w-8","h-8","rounded-full","flex","items-center","justify-center",3,"ngClass"],["fill","currentColor","viewBox","0 0 20 20",1,"w-4","h-4",3,"ngClass"],[1,"flex-1","min-w-0"],[1,"text-sm","text-gray-900"],[1,"text-xs","text-gray-500"],["class","text-sm text-primary-600 hover:text-primary-800",3,"click",4,"ngIf"],[1,"text-sm","text-primary-600","hover:text-primary-800",3,"click"],[1,"bg-gray-50","rounded-lg","p-4"],[1,"flex","items-center","justify-between","mb-3"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium",3,"ngClass"],[1,"space-y-2"],[1,"flex","justify-between","text-sm"],[1,"font-medium"],[1,"font-medium",3,"ngClass"],[1,"p-6","text-center","text-gray-500"],["fill","currentColor","viewBox","0 0 20 20",1,"w-12","h-12","mx-auto","mb-3","text-gray-300"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-medium","text-gray-900","truncate"],[1,"text-sm","text-gray-500"],[1,"text-right"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium",3,"ngClass"],[1,"p-4","bg-gray-50"],["routerLink","/stock",1,"text-sm","text-primary-600","hover:text-primary-500"]],template:function(p,m){if(1&p&&(t.j41(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),t.EFF(4," Estado del Inventario "),t.k0s(),t.j41(5,"p",3),t.EFF(6,"Resumen actual del inventario y alertas"),t.k0s()(),t.j41(7,"div",4)(8,"a",5),t.qSk(),t.j41(9,"svg",6),t.nrm(10,"path",7),t.k0s(),t.joV(),t.j41(11,"span"),t.EFF(12,"Ver Historial"),t.k0s()()()(),t.DNE(13,a,13,6,"div",8),t.nI1(14,"async"),t.nI1(15,"async"),t.j41(16,"div",9)(17,"div",10)(18,"h3",11),t.EFF(19," Inventario por Categor\xedas "),t.k0s()(),t.j41(20,"div",12)(21,"div",13),t.DNE(22,l,23,17,"div",14),t.nI1(23,"async"),t.k0s()()(),t.j41(24,"div",15)(25,"div",9)(26,"div",10)(27,"h3",11),t.EFF(28," Productos con Stock Bajo "),t.k0s()(),t.j41(29,"div",16),t.DNE(30,E,5,0,"div",17),t.nI1(31,"async"),t.DNE(32,D,12,10,"div",18),t.nI1(33,"async"),t.nI1(34,"slice"),t.DNE(35,x,3,0,"div",19),t.nI1(36,"async"),t.nI1(37,"async"),t.k0s()(),t.j41(38,"div",9)(39,"div",10)(40,"h3",11),t.EFF(41," Productos Pr\xf3ximos a Vencer "),t.k0s()(),t.j41(42,"div",16),t.DNE(43,b,5,0,"div",17),t.nI1(44,"async"),t.DNE(45,w,15,10,"div",18),t.nI1(46,"async"),t.nI1(47,"slice"),t.k0s()()(),t.j41(48,"div",20)(49,"h3",21),t.EFF(50,"Acciones R\xe1pidas"),t.k0s(),t.j41(51,"div",22)(52,"a",23)(53,"div",24),t.qSk(),t.j41(54,"svg",25),t.nrm(55,"path",26),t.k0s()(),t.joV(),t.j41(56,"div")(57,"p",27),t.EFF(58,"Agregar Producto"),t.k0s(),t.j41(59,"p",28),t.EFF(60,"Nuevo producto al inventario"),t.k0s()()(),t.j41(61,"a",29)(62,"div",30),t.qSk(),t.j41(63,"svg",31),t.nrm(64,"path",32),t.k0s()(),t.joV(),t.j41(65,"div")(66,"p",27),t.EFF(67,"Generar Reportes"),t.k0s(),t.j41(68,"p",28),t.EFF(69,"An\xe1lisis detallado"),t.k0s()()(),t.j41(70,"a",33)(71,"div",34),t.qSk(),t.j41(72,"svg",35),t.nrm(73,"path",36),t.k0s()(),t.joV(),t.j41(74,"div")(75,"p",27),t.EFF(76,"Gestionar Stock"),t.k0s(),t.j41(77,"p",28),t.EFF(78,"Ajustar existencias"),t.k0s()()()()()()),2&p){let r,n;t.R7$(13),t.Y8G("ngIf",t.bMT(14,7,m.alerts$)&&t.bMT(15,9,m.alerts$).length>0),t.R7$(9),t.Y8G("ngForOf",t.bMT(23,11,m.categoryStats$)),t.R7$(8),t.Y8G("ngIf",0===(null==(r=t.bMT(31,13,m.lowStockProducts$))?null:r.length)),t.R7$(2),t.Y8G("ngForOf",t.brH(34,17,t.bMT(33,15,m.lowStockProducts$),0,5)),t.R7$(3),t.Y8G("ngIf",t.bMT(36,21,m.lowStockProducts$)&&t.bMT(37,23,m.lowStockProducts$).length>5),t.R7$(8),t.Y8G("ngIf",0===(null==(n=t.bMT(44,25,m.expiringProducts$))?null:n.length)),t.R7$(2),t.Y8G("ngForOf",t.brH(47,29,t.bMT(46,27,m.expiringProducts$),0,5))}},dependencies:[v.MD,v.YU,v.Sq,v.bT,v.Jj,v.P9,v.QX,v.vh,g.iI,g.Wk],encapsulation:2})}}return i})()},2181:(_,O,d)=>{d.d(O,{Sz:()=>v,UB:()=>g,vT:()=>f});var v=function(t){return t.ACTIVO="ACTIVO",t.INACTIVO="INACTIVO",t.AGOTADO="AGOTADO",t.VENCIDO="VENCIDO",t.RESERVADO="RESERVADO",t}(v||{}),g=function(t){return t.ENTRADA="ENTRADA",t.SALIDA="SALIDA",t.AJUSTE="AJUSTE",t.TRANSFERENCIA="TRANSFERENCIA",t.DEVOLUCION="DEVOLUCION",t}(g||{}),f=function(t){return t.STOCK_BAJO="STOCK_BAJO",t.PRODUCTO_VENCIDO="PRODUCTO_VENCIDO",t.PRODUCTO_POR_VENCER="PRODUCTO_POR_VENCER",t.STOCK_AGOTADO="STOCK_AGOTADO",t}(f||{})},6241:(_,O,d)=>{d.d(O,{b:()=>k});var v=d(4412),g=d(7673),f=d(8810),t=d(6354),j=d(8384),h=d(2181),y=d(4438),F=d(7156);let k=(()=>{class I{constructor(c){this.http=c,this.products=new v.t([]),this.movements=new v.t([]),this.alerts=new v.t([]),this.products$=this.products.asObservable(),this.movements$=this.movements.asObservable(),this.alerts$=this.alerts.asObservable(),this.loadDemoData()}loadDemoData(){const c=[{id:"1",nombre:"Laptop HP Pavilion",descripcion:"Laptop HP Pavilion 15.6 pulgadas, 8GB RAM, 256GB SSD",precio:899.99,proveedor:"HP Inc.",cantidad:15,codigo1:"HP-LAP-001",codigo2:"PAV-156-8256",imagenes:["laptop-hp.jpg"],rubro:"Electr\xf3nicos",categoria:"Computadoras",marca:"HP",fechaVencimiento:void 0,lote:"LOT-2024-001",status:h.Sz.ACTIVO,notas:"Modelo m\xe1s vendido de la marca",ubicacion:"Almac\xe9n A - Estante 1",fechaCreacion:new Date("2024-01-15"),fechaActualizacion:new Date("2024-01-20")},{id:"2",nombre:"Mouse Inal\xe1mbrico Logitech",descripcion:"Mouse inal\xe1mbrico Logitech MX Master 3",precio:79.99,proveedor:"Logitech",cantidad:5,codigo1:"LOG-MOU-001",codigo2:"MX-MST-3",imagenes:["mouse-logitech.jpg"],rubro:"Electr\xf3nicos",categoria:"Accesorios",marca:"Logitech",fechaVencimiento:void 0,lote:"LOT-2024-002",status:h.Sz.ACTIVO,notas:"Stock bajo - reabastecer pronto",ubicacion:"Almac\xe9n A - Estante 2",fechaCreacion:new Date("2024-01-10"),fechaActualizacion:new Date("2024-01-18")},{id:"3",nombre:"Medicamento Paracetamol",descripcion:"Paracetamol 500mg - Caja con 20 tabletas",precio:5.99,proveedor:"Farmac\xe9utica ABC",cantidad:0,codigo1:"MED-PAR-001",codigo2:"PAR-500-20",imagenes:["paracetamol.jpg"],rubro:"Farmacia",categoria:"Analg\xe9sicos",marca:"Gen\xe9rico",fechaVencimiento:new Date("2024-12-31"),lote:"LOT-2024-003",status:h.Sz.AGOTADO,notas:"Producto agotado - pedido urgente",ubicacion:"Farmacia - Estante B",fechaCreacion:new Date("2024-01-05"),fechaActualizacion:new Date("2024-01-22")}],a=[{id:"1",productId:"1",tipo:h.UB.ENTRADA,cantidad:20,cantidadAnterior:0,cantidadNueva:20,motivo:"Compra inicial de inventario",usuario:"admin@inventory.com",fecha:new Date("2024-01-15"),lote:"LOT-2024-001",ubicacion:"Almac\xe9n A - Estante 1"},{id:"2",productId:"1",tipo:h.UB.SALIDA,cantidad:5,cantidadAnterior:20,cantidadNueva:15,motivo:"Venta al cliente",usuario:"manager@inventory.com",fecha:new Date("2024-01-20"),lote:"LOT-2024-001",ubicacion:"Almac\xe9n A - Estante 1"}],l=[{id:"1",productId:"2",tipo:h.vT.STOCK_BAJO,message:"Stock bajo: Mouse Inal\xe1mbrico Logitech (5 unidades)",fecha:new Date,leido:!1},{id:"2",productId:"3",tipo:h.vT.STOCK_AGOTADO,message:"Stock agotado: Medicamento Paracetamol",fecha:new Date,leido:!1}];this.products.next(c),this.movements.next(a),this.alerts.next(l)}getProducts(){return this.products$}getProduct(c){return this.products$.pipe((0,t.T)(a=>a.find(l=>l.id===c)))}createProduct(c){const a={id:this.generateId(),...c,precio:Number(c.precio),cantidad:Number(c.cantidad),imagenes:[],fechaVencimiento:c.fechaVencimiento?new Date(c.fechaVencimiento):void 0,fechaCreacion:new Date,fechaActualizacion:new Date};return this.products.next([...this.products.value,a]),this.addInventoryMovement({productId:a.id,tipo:h.UB.ENTRADA,cantidad:a.cantidad,cantidadAnterior:0,cantidadNueva:a.cantidad,motivo:"Creaci\xf3n de producto",usuario:"current-user",fecha:new Date,lote:a.lote,ubicacion:a.ubicacion}),(0,g.of)(a).pipe((0,j.c)(500))}updateProduct(c,a){const l=this.products.value,E=l.findIndex(b=>b.id===c);if(-1===E)return(0,f.$)(()=>new Error("Producto no encontrado"));const D=l[E],x={...D,...a,precio:Number(a.precio),cantidad:Number(a.cantidad),fechaVencimiento:a.fechaVencimiento?new Date(a.fechaVencimiento):void 0,fechaActualizacion:new Date};if(D.cantidad!==x.cantidad){const b=x.cantidad-D.cantidad;this.addInventoryMovement({productId:c,tipo:b>0?h.UB.ENTRADA:h.UB.SALIDA,cantidad:Math.abs(b),cantidadAnterior:D.cantidad,cantidadNueva:x.cantidad,motivo:"Ajuste de inventario",usuario:"current-user",fecha:new Date,lote:x.lote,ubicacion:x.ubicacion})}return l[E]=x,this.products.next([...l]),(0,g.of)(x).pipe((0,j.c)(500))}deleteProduct(c){const l=this.products.value.filter(E=>E.id!==c);return this.products.next(l),(0,g.of)(!0).pipe((0,j.c)(500))}getInventoryMovements(){return this.movements$}addInventoryMovement(c){const a={id:this.generateId(),...c};this.movements.next([a,...this.movements.value])}getStockAlerts(){return this.alerts$}markAlertAsRead(c){const a=this.alerts.value,l=a.findIndex(E=>E.id===c);return-1!==l&&(a[l].leido=!0,this.alerts.next([...a])),(0,g.of)(!0)}generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,5)}searchProducts(c){return this.products$.pipe((0,t.T)(a=>a.filter(l=>l.nombre.toLowerCase().includes(c.toLowerCase())||l.codigo1.toLowerCase().includes(c.toLowerCase())||l.codigo2.toLowerCase().includes(c.toLowerCase())||l.marca.toLowerCase().includes(c.toLowerCase()))))}getProductsByCategory(c){return this.products$.pipe((0,t.T)(a=>a.filter(l=>l.categoria===c)))}getLowStockProducts(c=10){return this.products$.pipe((0,t.T)(a=>a.filter(l=>l.cantidad<=c)))}static{this.\u0275fac=function(a){return new(a||I)(y.KVO(F.Qq))}}static{this.\u0275prov=y.jDH({token:I,factory:I.\u0275fac,providedIn:"root"})}}return I})()},8384:(_,O,d)=>{d.d(O,{c:()=>m});var v=d(8359);class g extends v.yU{constructor(n,o){super()}schedule(n,o=0){return this}}const f={setInterval(r,n,...o){const{delegate:s}=f;return s?.setInterval?s.setInterval(r,n,...o):setInterval(r,n,...o)},clearInterval(r){const{delegate:n}=f;return(n?.clearInterval||clearInterval)(r)},delegate:void 0};var t=d(7908);const h={now:()=>(h.delegate||Date).now(),delegate:void 0};class y{constructor(n,o=y.now){this.schedulerActionCtor=n,this.now=o}schedule(n,o=0,s){return new this.schedulerActionCtor(this,n).schedule(s,o)}}y.now=h.now;const k=new class F extends y{constructor(n,o=y.now){super(n,o),this.actions=[],this._active=!1}flush(n){const{actions:o}=this;if(this._active)return void o.push(n);let s;this._active=!0;do{if(s=n.execute(n.state,n.delay))break}while(n=o.shift());if(this._active=!1,s){for(;n=o.shift();)n.unsubscribe();throw s}}}(class j extends g{constructor(n,o){super(n,o),this.scheduler=n,this.work=o,this.pending=!1}schedule(n,o=0){var s;if(this.closed)return this;this.state=n;const A=this.id,C=this.scheduler;return null!=A&&(this.id=this.recycleAsyncId(C,A,o)),this.pending=!0,this.delay=o,this.id=null!==(s=this.id)&&void 0!==s?s:this.requestAsyncId(C,this.id,o),this}requestAsyncId(n,o,s=0){return f.setInterval(n.flush.bind(n,this),s)}recycleAsyncId(n,o,s=0){if(null!=s&&this.delay===s&&!1===this.pending)return o;null!=o&&f.clearInterval(o)}execute(n,o){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const s=this._execute(n,o);if(s)return s;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,o){let A,s=!1;try{this.work(n)}catch(C){s=!0,A=C||new Error("Scheduled action threw falsy error")}if(s)return this.unsubscribe(),A}unsubscribe(){if(!this.closed){const{id:n,scheduler:o}=this,{actions:s}=o;this.work=this.state=this.scheduler=null,this.pending=!1,(0,t.o)(s,this),null!=n&&(this.id=this.recycleAsyncId(o,n,null)),this.delay=null,super.unsubscribe()}}}),I=k;var R=d(8793),c=d(6697),a=d(9974),l=d(4360),E=d(5343),x=d(3703),b=d(1397),w=d(8750);function T(r,n){return n?o=>(0,R.x)(n.pipe((0,c.s)(1),function D(){return(0,a.N)((r,n)=>{r.subscribe((0,l._)(n,E.l))})}()),o.pipe(T(r))):(0,b.Z)((o,s)=>(0,w.Tg)(r(o,s)).pipe((0,c.s)(1),(0,x.u)(o)))}var i=d(1985),u=d(9470);function m(r,n=k){const o=function p(r=0,n,o=I){let s=-1;return null!=n&&((0,u.m)(n)?o=n:s=n),new i.c(A=>{let C=function e(r){return r instanceof Date&&!isNaN(r)}(r)?+r-o.now():r;C<0&&(C=0);let P=0;return o.schedule(function(){A.closed||(A.next(P++),0<=s?this.schedule(void 0,s):A.complete())},C)})}(r,n);return T(()=>o)}}}]);